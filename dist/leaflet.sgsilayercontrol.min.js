function LayerControlGroup(e,t,l){l=l||[],l.display=l.display||"show",l.label=l.label||"unchecked",l.selectedItemName=l.selectedItemName||"",e&&e.constructor===Array||(e=[e]),this.layers=e,this.name=t;for(var a in e)this.layers[a].groupName=t;if(this.setDisplay=function(e){this.displayElement&&(e?(this.displayElement.classList.add("leaflet-control-display-checked"),this.displayElement.classList.remove("leaflet-control-display-unchecked")):(this.displayElement.classList.remove("leaflet-control-display-checked"),this.displayElement.classList.add("leaflet-control-display-unchecked")))},this.getDisplay=function(){return!this.displayElement||this.displayElement.classList.contains("leaflet-control-display-checked")},this.setLabeled=function(e){this.labelElement&&(e?(this.labelElement.classList.add("leaflet-control-label-checked"),this.labelElement.classList.remove("leaflet-control-label-unchecked")):(this.labelElement.classList.remove("leaflet-control-label-checked"),this.labelElement.classList.add("leaflet-control-label-unchecked")))},this.getLabeled=function(){return!this.labelElement||this.labelElement.classList.contains("leaflet-control-label-checked")},this.getSelectedLayer=function(){if(1===this.layers.length)return this.layers[0];if(this.selectElement){var e=this.selectElement.options[this.selectElement.selectedIndex].value,t=this._getLayerByName(e);return t}return null},this.setSelectedLayer=function(e){if(this.selectElement){var t=this.layers.indexOf(e);t>=0&&(this.selectElement.options[t].selected=!0)}},"hide"!==l.display&&(this.displayElement=document.createElement("div"),this.displayElement.LayerControlAction=LayerControlAction.ToggleDisplay,this.displayElement.groupName=this.name,this.setDisplay(!1)),"hide"!==l.label&&(this.labelElement=document.createElement("div"),this.labelElement.LayerControlAction=LayerControlAction.ToggleLabels,this.labelElement.groupName=this.name,this.setLabeled("checked"===l.label)),this.nameElement=document.createElement("span"),this.nameElement.innerHTML=" "+this.name,this.nameElement.groupName=this.name,e&&e.constructor===Array&&e.length>1){for(var n='<select class="leaflet-control-layers-selector" onmouseout="if (arguments[0]) {arguments[0].stopPropagation();} else {window.event.cancelBubble();}">',a=0;a<this.layers.length;a++){var i=this.layers[a],t=i.options.name,s=l.selectedItemName===i.options.labelSource?"selected":"";n+="<option "+s+' value="'+t+'">'+t+"</option>"}n+="</select>";var o=document.createElement("div");o.innerHTML=n,o.firstChild.LayerControlAction=LayerControlAction.SelectLayer,o.firstChild.groupName=this.name,this.selectElement=o.firstChild}this._getLayerByName=function(e){var t=this.layers.filter(function(t){return t.options.name===e});return t.length>0?t[0]:null},this._anyLayerVisible=function(e){return this.layers.filter(function(t){return e.hasLayer(t)}).length>0},this.init=function(e){var t=this.layers.filter(function(t){return e.hasLayer(t)});this.setDisplay(t.length>0),t.length>0&&this.setSelectedLayer(t[0])}}var LayerControlAction={ToggleDisplay:1,ToggleLabels:2,SelectLayer:3};L.Control.GroupedLayers=L.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,labelCallback:null},initialize:function(e,t){var l,a,n;L.Util.setOptions(this,t),this._layers={},this._groups=e,this._lastZIndex=0,this._handlingClick=!1;for(l in this._groups){n=this._groups[l];for(a in n.layers)this._addLayer(n.layers[a])}},_getGroupByName:function(e){var t=this._groups.filter(function(t){return t.name===e});return t.length>0?t[0]:null},_addLayer:function(e){var t=L.Util.stamp(e);this._layers[t]=e,this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex))},onAdd:function(e){return this._initLayout(),this._update(),e.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container},onRemove:function(e){e.off("layeradd",this._onLayerChange).off("layerremove",this._onLayerChange)},_initLayout:function(){var e="leaflet-control-layers",t=this._container=L.DomUtil.create("div",e);t.setAttribute("aria-haspopup",!0),L.Browser.touch?L.DomEvent.on(t,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(t),L.DomEvent.on(t,"wheel",L.DomEvent.stopPropagation));var l=this._form=L.DomUtil.create("form",e+"-list");if(this.options.collapsed){L.Browser.android||L.DomEvent.on(t,"mouseover",this._expand,this).on(t,"mouseout",this._collapse,this);var a=this._layersLink=L.DomUtil.create("a",e+"-toggle",t);a.href="#",a.title="Layers",L.Browser.touch?L.DomEvent.on(a,"click",L.DomEvent.stop).on(a,"click",this._expand,this):L.DomEvent.on(a,"focus",this._expand,this),this._map.on("click",this._collapse,this)}else this._expand();this._groupTable=L.DomUtil.create("table",e+"-overlays",l),t.appendChild(l)},_update:function(){if(this._container){this._groupTable.innerHTML="";for(var e in this._groups)this._addGroup(this._groups[e])}},_onLayerChange:function(e){var t=this._layers[L.Util.stamp(e.layer)];if(t){this._handlingClick||this._update();var l=this._getGroupByName(t.groupName),a=l&&!l.displayElement,n=a?"layeradd"===e.type?"baselayerchange":null:"layeradd"===e.type?"overlayadd":"overlayremove";n&&this._map.fire(n,t)}},_addGroup:function(e){e.init(this._map);var t,l;return t=document.createElement("tr"),l=document.createElement("td"),e.displayElement?(L.DomEvent.on(e.displayElement,"click",this._onLayerControlAction,this),l.appendChild(e.displayElement)):l.innerHTML="&nbsp;",t.appendChild(l),l=document.createElement("td"),e.labelElement?(L.DomEvent.on(e.labelElement,"click",this._onLayerControlAction,this),l.appendChild(e.labelElement)):l.innerHTML="&nbsp;",t.appendChild(l),l=document.createElement("td"),l.appendChild(e.nameElement),e.selectElement&&(L.DomEvent.on(e.selectElement,"change",this._onLayerControlAction,this),l.appendChild(e.selectElement)),t.appendChild(l),this._groupTable.appendChild(t),t},_onLayerControlAction:function(e){var t,l,a,n,i;switch(this._handlingClick=!0,l=this._getGroupByName(e.currentTarget.groupName),a=l.getSelectedLayer(),e.currentTarget.LayerControlAction){case LayerControlAction.ToggleDisplay:l.setDisplay(!l.getDisplay()),i=l.getDisplay();for(t in l.layers)n=l.layers[t],this._setLayerDisplay(n,n===a&&i);break;case LayerControlAction.ToggleLabels:l.setLabeled(!l.getLabeled()),this.options.labelCallback&&this.options.labelCallback(this._getLabeledLayers());break;case LayerControlAction.SelectLayer:i=l.getDisplay();for(t in l.layers)n=l.layers[t],this._setLayerDisplay(n,n===a&&i);this.options.labelCallback&&l.getLabeled()&&this.options.labelCallback(this._getLabeledLayers())}this._handlingClick=!1},_setLayerDisplay:function(e,t){var l=this._map.hasLayer(e);l!==t&&(t?this._map.addLayer(e):this._map.removeLayer(e))},_getLabeledLayers:function(){return this._groups.filter(function(e){return e.getLabeled()}).map(function(e){return e.getSelectedLayer()})},_expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}}),L.control.groupedLayers=function(e,t){return new L.Control.GroupedLayers(e,t)};